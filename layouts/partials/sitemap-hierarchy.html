{{/* Load sitemap data from data/sitemap-pages.json */}}
{{ $sitemapData := .Site.Data.sitemap_pages }}
{{ $organized := $sitemapData.organized }}

{{/* Helper function to generate anchor text based on priority and video status */}}
{{ define "anchorText" }}
  {{ $page := . }}
  {{ $cityName := $page.city_name | default (path.Base $page.url_path) }}

  {{/* Tier S: Priority pages - use title as-is */}}
  {{ if eq $page.tier "S" }}
    {{ $page.title }}

  {{/* Tier B: Paris arrondissements - descriptive with landmarks */}}
  {{ else if and (eq $page.tier "B") (eq $page.department "75") }}
    {{ $arrNum := replaceRE "^.*/paris-" "" $page.url_path | replaceRE "[^0-9].*$" "" }}
    {{ $arrSuffix := cond (eq $arrNum "1") "er" "e" }}
    {{ $landmark := "" }}
    {{ if eq $arrNum "1" }}{{ $landmark = " - Louvre, Ch√¢telet" }}
    {{ else if eq $arrNum "2" }}{{ $landmark = " - Bourse, Op√©ra" }}
    {{ else if eq $arrNum "3" }}{{ $landmark = " - Marais, R√©publique" }}
    {{ else if eq $arrNum "4" }}{{ $landmark = " - √éle de la Cit√©, Notre-Dame" }}
    {{ else if eq $arrNum "5" }}{{ $landmark = " - Quartier Latin, Panth√©on" }}
    {{ else if eq $arrNum "6" }}{{ $landmark = " - Saint-Germain-des-Pr√©s" }}
    {{ else if eq $arrNum "7" }}{{ $landmark = " - Tour Eiffel, Invalides" }}
    {{ else if eq $arrNum "8" }}{{ $landmark = " - Champs-√âlys√©es, Arc de Triomphe" }}
    {{ else if eq $arrNum "11" }}{{ $landmark = " - Bastille, Oberkampf" }}
    {{ else if eq $arrNum "13" }}{{ $landmark = " - Place d'Italie, BNF" }}
    {{ else if eq $arrNum "14" }}{{ $landmark = " - Montparnasse, Catacombes" }}
    {{ else if eq $arrNum "15" }}{{ $landmark = " - Vaugirard, Tour Eiffel" }}
    {{ else if eq $arrNum "16" }}{{ $landmark = " - Trocad√©ro, Auteuil" }}
    {{ else if eq $arrNum "18" }}{{ $landmark = " - Montmartre, Sacr√©-C≈ìur" }}
    {{ end }}
    √âlectricien Paris {{ $arrNum }}{{ $arrSuffix }}{{ $landmark }}

  {{/* Tier C: Major suburbs - service + location format */}}
  {{ else if eq $page.tier "C" }}
    {{ if $page.has_video }}
      D√©pannage √©lectricit√© {{ $cityName }} (Vid√©o)
    {{ else }}
      √âlectricien {{ $cityName }}{{ with $page.zip_code }} ({{ . }}){{ end }}
    {{ end }}

  {{/* Tier D: Standard communes - simple format */}}
  {{ else }}
    {{ $cityName }}{{ with $page.zip_code }} ({{ . }}){{ end }}
  {{ end }}
{{ end }}

<div class="sitemap-hierarchy">

  {{/* ========================================
       TIER S: PRIORITY PAGES (Priority 1.0)
       ======================================== */}}
  {{ with $organized.tier_s }}
  {{ if gt (len .) 0 }}
  <section id="urgence" class="sitemap-tier sitemap-tier-s mb-12">
    <div class="bg-gradient-to-r from-red-50 to-orange-50 rounded-lg p-8 shadow-lg">
      <h2 class="text-3xl font-bold text-red-700 mb-6 flex items-center">
        <span class="text-4xl mr-3">üö®</span>
        Services Urgents & Prioritaires
      </h2>

      <div class="grid md:grid-cols-3 gap-6">
        <!-- Urgence √âlectrique -->
        <div class="bg-white rounded-lg p-6 shadow-md">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Urgence √âlectrique</h3>
          <ul class="space-y-2">
            <li><a href="/sos-electricien/" class="text-blue-600 hover:text-blue-800 hover:underline font-semibold">ALLO ELECTRICIEN PRO - Intervention &lt;30min</a></li>
            <li><a href="/depannage-electricite-paris/" class="text-blue-600 hover:text-blue-800 hover:underline">D√©pannage √âlectricit√© Paris Urgence</a></li>
            <li><a href="/electricien-paris/" class="text-blue-600 hover:text-blue-800 hover:underline">√âlectricien Paris 24/7</a></li>
          </ul>
        </div>

        <!-- Services Principaux -->
        <div class="bg-white rounded-lg p-6 shadow-md">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Services Principaux</h3>
          <ul class="space-y-2">
            <li><a href="/services/" class="text-blue-600 hover:text-blue-800 hover:underline">Tous nos Services √âlectricit√©</a></li>
            <li><a href="/annuaire/" class="text-blue-600 hover:text-blue-800 hover:underline">Annuaire - 408 √âlectriciens</a></li>
            <li><a href="/tarifs/" class="text-blue-600 hover:text-blue-800 hover:underline">Tarifs & Devis Gratuit</a></li>
            <li><a href="/zones-intervention/" class="text-blue-600 hover:text-blue-800 hover:underline">Zones d'Intervention IDF</a></li>
            <li><a href="/faq/" class="text-blue-600 hover:text-blue-800 hover:underline">Questions Fr√©quentes</a></li>
          </ul>
        </div>

        <!-- D√©partements -->
        <div class="bg-white rounded-lg p-6 shadow-md">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Par D√©partement</h3>
          <ul class="space-y-2">
            <li><a href="/electricien/75/" class="text-blue-600 hover:text-blue-800 hover:underline">Paris (75) - 20 Arrondissements</a></li>
            <li><a href="/electricien/92/" class="text-blue-600 hover:text-blue-800 hover:underline">Hauts-de-Seine (92)</a></li>
            <li><a href="/electricien/93/" class="text-blue-600 hover:text-blue-800 hover:underline">Seine-Saint-Denis (93)</a></li>
            <li><a href="/electricien/94/" class="text-blue-600 hover:text-blue-800 hover:underline">Val-de-Marne (94)</a></li>
            <li><a href="/electricien/78/" class="text-blue-600 hover:text-blue-800 hover:underline">Yvelines (78)</a></li>
            <li><a href="/electricien/91/" class="text-blue-600 hover:text-blue-800 hover:underline">Essonne (91)</a></li>
            <li><a href="/electricien/95/" class="text-blue-600 hover:text-blue-800 hover:underline">Val-d'Oise (95)</a></li>
            <li><a href="/electricien/77/" class="text-blue-600 hover:text-blue-800 hover:underline">Seine-et-Marne (77)</a></li>
          </ul>
        </div>
      </div>
    </div>
  </section>
  {{ end }}
  {{ end }}

  {{/* ========================================
       TIER B: PARIS ARRONDISSEMENTS (Priority 0.9)
       ======================================== */}}
  {{ with $organized.tier_b.paris }}
  {{ if gt (len .) 0 }}
  <section id="paris" class="sitemap-tier sitemap-tier-b mb-12">
    <div class="border-4 border-red-600 rounded-lg p-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-4 flex items-center">
        <span class="text-4xl mr-3">üèôÔ∏è</span>
        √âlectricien Paris - Tous les Arrondissements
      </h2>

      <p class="text-lg text-gray-700 mb-6">
        Service d'urgence √©lectrique dans les <strong>20 arrondissements de Paris</strong>.
        Intervention garantie en moins de 30 minutes. Cliquez sur votre arrondissement
        pour trouver un √©lectricien de proximit√©.
      </p>

      {{/* Group Paris arrondissements by zones (20 total) */}}
      {{ $parisCentre := slice }}
      {{ $parisOuest := slice }}
      {{ $parisNord := slice }}
      {{ $parisEst := slice }}
      {{ $parisSud := slice }}

      {{ range . }}
        {{ $arrNum := replaceRE "^.*/paris-" "" .url_path | replaceRE "[^0-9].*$" "" }}
        {{/* Paris Centre (4): 1, 2, 3, 4 */}}
        {{ if in (slice "1" "2" "3" "4") $arrNum }}
          {{ $parisCentre = $parisCentre | append . }}
        {{/* Paris Ouest (5): 7, 8, 15, 16, 17 */}}
        {{ else if in (slice "7" "8" "15" "16" "17") $arrNum }}
          {{ $parisOuest = $parisOuest | append . }}
        {{/* Paris Nord (3): 9, 10, 18 */}}
        {{ else if in (slice "9" "10" "18") $arrNum }}
          {{ $parisNord = $parisNord | append . }}
        {{/* Paris Est (4): 11, 12, 19, 20 */}}
        {{ else if in (slice "11" "12" "19" "20") $arrNum }}
          {{ $parisEst = $parisEst | append . }}
        {{/* Paris Sud (4): 5, 6, 13, 14 */}}
        {{ else if in (slice "5" "6" "13" "14") $arrNum }}
          {{ $parisSud = $parisSud | append . }}
        {{ end }}
      {{ end }}

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Paris Centre -->
        {{ if gt (len $parisCentre) 0 }}
        <div class="paris-zone bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Paris Centre - C≈ìur Historique</h3>
          <ul class="space-y-2">
            {{ range $parisCentre }}
            <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .url_path }}">
              <a href="{{ .url_path }}/" class="text-blue-600 hover:text-blue-800 hover:underline">
                {{ template "anchorText" . }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}

        <!-- Paris Ouest -->
        {{ if gt (len $parisOuest) 0 }}
        <div class="paris-zone bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Paris Ouest - Quartiers Prestigieux</h3>
          <ul class="space-y-2">
            {{ range $parisOuest }}
            <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .url_path }}">
              <a href="{{ .url_path }}/" class="text-blue-600 hover:text-blue-800 hover:underline">
                {{ template "anchorText" . }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}

        <!-- Paris Nord -->
        {{ if gt (len $parisNord) 0 }}
        <div class="paris-zone bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Paris Nord</h3>
          <ul class="space-y-2">
            {{ range $parisNord }}
            <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .url_path }}">
              <a href="{{ .url_path }}/" class="text-blue-600 hover:text-blue-800 hover:underline">
                {{ template "anchorText" . }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}

        <!-- Paris Est -->
        {{ if gt (len $parisEst) 0 }}
        <div class="paris-zone bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Paris Est - Quartiers Vivants</h3>
          <ul class="space-y-2">
            {{ range $parisEst }}
            <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .url_path }}">
              <a href="{{ .url_path }}/" class="text-blue-600 hover:text-blue-800 hover:underline">
                {{ template "anchorText" . }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}

        <!-- Paris Sud -->
        {{ if gt (len $parisSud) 0 }}
        <div class="paris-zone bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Paris Sud - Rive Gauche</h3>
          <ul class="space-y-2">
            {{ range $parisSud }}
            <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .url_path }}">
              <a href="{{ .url_path }}/" class="text-blue-600 hover:text-blue-800 hover:underline">
                {{ template "anchorText" . }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}
  {{ end }}

  {{/* ========================================
       TIER C: MAJOR SUBURBS (Priority 0.7-0.85)
       ======================================== */}}
  <section id="grandes-villes" class="sitemap-tier sitemap-tier-c mb-12">
    <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
      <span class="text-4xl mr-3">üåÜ</span>
      Grandes Villes d'√éle-de-France - Intervention Rapide
    </h2>

    <p class="text-lg text-gray-700 mb-8">
      Nos √©lectriciens interviennent en urgence dans les principales villes
      d'√éle-de-France. Voici les <strong>principales communes les plus demand√©es</strong>
      class√©es par d√©partement.
    </p>

    {{ $deptNames := dict "75" "Paris" "77" "Seine-et-Marne" "78" "Yvelines" "91" "Essonne" "92" "Hauts-de-Seine" "93" "Seine-Saint-Denis" "94" "Val-de-Marne" "95" "Val-d'Oise" }}
    {{ $deptOrder := slice "92" "93" "94" "78" "91" "95" "77" }}

    {{ range $deptOrder }}
      {{ $dept := . }}
      {{ $deptName := index $deptNames $dept }}
      {{ $pages := index $organized.tier_c_by_dept $dept }}

      {{ if $pages }}{{ if gt (len $pages) 0 }}
      <div class="department-cities mb-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
          <span class="inline-block bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center text-lg font-bold mr-3">{{ $dept }}</span>
          {{ $deptName }} - √âlectricien Urgence
        </h3>

        <ul class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
          {{ range first 10 $pages }}
          <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .department }} {{ .url_path }}">
            <a href="{{ .url_path }}/" class="block px-3 py-2 bg-white rounded hover:bg-blue-50 hover:shadow transition-all text-blue-600 hover:text-blue-800">
              {{ template "anchorText" . }}
            </a>
          </li>
          {{ end }}
        </ul>

        <p class="mt-4 text-sm text-gray-600">
          <a href="/electricien/{{ $dept }}/" class="text-blue-600 hover:text-blue-800 font-semibold hover:underline">
            ‚Üí Voir toutes les communes {{ if eq $dept "75" }}de Paris{{ else }}de {{ $deptName }}{{ end }}
          </a>
        </p>
      </div>
      {{ end }}{{ end }}
    {{ end }}
  </section>

  {{/* ========================================
       TIER D: ALL COMMUNES (Priority 0.5) - Collapsible by Department
       ======================================== */}}
  <section id="departements" class="sitemap-tier sitemap-tier-d mb-12">
    <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
      <span class="text-4xl mr-3">üèòÔ∏è</span>
      Toutes les Communes d'√éle-de-France
    </h2>

    <p class="text-lg text-gray-700 mb-6">
      Liste compl√®te des <strong>1,260+ communes</strong> couvertes par notre r√©seau
      d'√©lectriciens. Cliquez sur un d√©partement pour voir toutes les communes.
    </p>

    {{ range $deptOrder }}
      {{ $dept := . }}
      {{ $deptName := index $deptNames $dept }}
      {{ $pages := index $organized.tier_d_by_dept $dept }}

      {{ if and $pages (gt (len $pages) 0) }}
      <details class="department-accordion mb-4 border border-gray-300 rounded-lg">
        <summary class="cursor-pointer p-4 bg-gray-100 hover:bg-gray-200 rounded-lg font-semibold text-lg flex items-center justify-between">
          <span class="flex items-center">
            <span class="inline-block bg-blue-600 text-white rounded-full w-10 h-10 flex items-center justify-center text-base font-bold mr-3">{{ $dept }}</span>
            <span>{{ $deptName }} - √âlectricien</span>
          </span>
          <span class="text-sm text-gray-600 font-normal">{{ len $pages }} communes</span>
        </summary>

        <div class="p-4 bg-white">
          <ul class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
            {{ range $pages }}
            <li class="sitemap-item" data-search-terms="{{ .city_name }} {{ .zip_code }} {{ .department }} {{ .url_path }}">
              <a href="{{ .url_path }}/" class="block px-2 py-1 hover:bg-blue-50 rounded text-blue-600 hover:text-blue-800 text-sm">
                {{ template "anchorText" . }}
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
      </details>
      {{ end }}
    {{ end }}
  </section>

  {{/* ========================================
       SERVICES & RESOURCES
       ======================================== */}}
  <section id="services" class="sitemap-services mb-12">
    <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
      <span class="text-4xl mr-3">üîß</span>
      Services & Ressources
    </h2>

    <div class="grid md:grid-cols-3 gap-6">
      <!-- Services √âlectricit√© -->
      <div class="bg-gray-50 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Services √âlectricit√©</h3>
        <ul class="space-y-2">
          <li><a href="/services/" class="text-blue-600 hover:text-blue-800 hover:underline">Vue d'ensemble des services</a></li>
          <li><a href="/services/installation-electrique-paris/" class="text-blue-600 hover:text-blue-800 hover:underline">Installation √©lectrique</a></li>
          <li><a href="/services/mise-aux-normes-paris/" class="text-blue-600 hover:text-blue-800 hover:underline">Mise aux normes NF C 15-100</a></li>
          <li><a href="/services/court-circuit-paris/" class="text-blue-600 hover:text-blue-800 hover:underline">R√©paration court-circuit</a></li>
          <li><a href="/services/panne-electrique-paris/" class="text-blue-600 hover:text-blue-800 hover:underline">D√©pannage panne √©lectrique</a></li>
        </ul>
      </div>

      <!-- Guides & Conseils -->
      <div class="bg-gray-50 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Guides & Conseils</h3>
        <ul class="space-y-2">
          <li><a href="/conseils/" class="text-blue-600 hover:text-blue-800 hover:underline">Tous nos conseils √©lectricit√©</a></li>
          <li><a href="/faq/" class="text-blue-600 hover:text-blue-800 hover:underline">Questions fr√©quentes</a></li>
        </ul>
      </div>

      <!-- Informations Pratiques -->
      <div class="bg-gray-50 rounded-lg p-6">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Informations Pratiques</h3>
        <ul class="space-y-2">
          <li><a href="/tarifs/" class="text-blue-600 hover:text-blue-800 hover:underline">Tarifs & Devis gratuit</a></li>
          <li><a href="/zones-intervention/" class="text-blue-600 hover:text-blue-800 hover:underline">Zones d'intervention</a></li>
          <li><a href="/mentions-legales/" class="text-blue-600 hover:text-blue-800 hover:underline">Mentions l√©gales</a></li>
          <li><a href="/politique-confidentialite/" class="text-blue-600 hover:text-blue-800 hover:underline">Politique de confidentialit√©</a></li>
        </ul>
      </div>
    </div>
  </section>

</div>
