{{- if .IsHome }}
<!-- WebSite Schema with SearchAction -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "{{ .Site.BaseURL }}",
  "name": "SOS Électricien Paris - Dépannage Électrique Urgence",
  "alternateName": "Allo Électricien",
  "description": "{{ .Site.Params.description }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Params.companyName }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.BaseURL }}images/logo_1.svg"
    }
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ .Site.BaseURL }}search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  },
  "sameAs": [
    "https://g.page/allo-electricien-paris"
  ],
  "mainEntity": {
    "@type": "Organization",
    "name": "{{ .Site.Params.companyName }}",
    "legalName": "{{ .Site.Params.companyName }} {{ .Site.Params.companyLegalForm }}",
    "url": "{{ .Site.BaseURL }}",
    "logo": "{{ .Site.BaseURL }}images/logo_1.svg",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+33-1-44-90-11-31",
      "contactType": "emergency",
      "areaServed": "FR",
      "availableLanguage": "French"
    },
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "{{ .Site.Params.address }}",
      "addressLocality": "{{ .Site.Params.city }}",
      "postalCode": "{{ .Site.Params.postalCode }}",
      "addressCountry": "FR"
    }
  }
}
</script>

<!-- FAQPage Schema for SEO -->
{{ with .Site.Data.faq }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {{ range $index, $item := . }}{{ if $index }},{{ end }}
    {
      "@type": "Question",
      "name": "{{ $item.question }}",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{{ $item.answer }}"
      }
    }
    {{ end }}
  ]
}
</script>
{{ end }}

{{- else }}

{{- if eq .Section "services" }}
  {{/* SERVICE PAGES: Use comprehensive service schema with Service, FAQ, HowTo, and Offer schemas */}}
  {{ partial "service-schema.html" . }}
{{- else }}
  {{/* CITY/LOCATION PAGES: Use EmergencyService schema */}}
  <!-- Business Schema for Individual Pages with Emergency Service -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "EmergencyService",
    "name": "nos électriciens {{ .Params.city }}",
    "knowsAbout": ["Dépannage électrique urgent", "SOS électricien", "Intervention rapide"],
  {{- $schemaOgImage := "" -}}
  {{- $schemaHeroImage := "" -}}
  {{- if .Params.cdnImages.og.jpg -}}
    {{- $schemaOgImage = .Params.cdnImages.og.jpg -}}
  {{- else if .Params.images.og -}}
    {{- $schemaOgImage = printf "%simages/og/%s.jpg" .Site.BaseURL .Params.images.og -}}
  {{- end -}}
  {{- if .Params.cdnImages.hero.jpg -}}
    {{- $schemaHeroImage = .Params.cdnImages.hero.jpg -}}
  {{- else if .Params.images.hero -}}
    {{- $schemaHeroImage = printf "%simages/hero/%s.jpg" .Site.BaseURL .Params.images.hero -}}
  {{- end -}}
  {{- if or $schemaOgImage $schemaHeroImage }}
  "image": [
    {{- if $schemaOgImage }}"{{ $schemaOgImage }}"{{- if $schemaHeroImage }},{{ end }}{{ end }}
    {{- if $schemaHeroImage }}"{{ $schemaHeroImage }}"{{ end }}
  ],
  {{- else }}
  "image": "{{ .Site.BaseURL }}images/logo_1.svg",
  {{- end }}
  "description": "{{ .Params.description }}",
  "@id": "{{ .Permalink }}",
  "url": "{{ .Permalink }}",
  "telephone": "{{ .Params.phone | default .Site.Params.mainPhone }}",
  "priceRange": "€€",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "{{ .Params.city }}",
    "postalCode": "{{ .Params.zipCode }}",
    "addressCountry": "FR"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": {{ .Params.coordinates.lat | default 48.8566 }},
    "longitude": {{ .Params.coordinates.lng | default 2.3522 }}
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": "2450",
    "bestRating": "5",
    "worstRating": "1"
  },
  "openingHoursSpecification": {
    "@type": "OpeningHoursSpecification",
    "dayOfWeek": [
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday",
      "Sunday"
    ],
    "opens": "00:00",
    "closes": "23:59"
  },
  "areaServed": {
    "@type": "City",
    "name": "{{ .Params.city }}"
  }
}
</script>

<!-- Organization Schema for Authority -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "ECLAT RAPIDE ELECTRICITE",
  "alternateName": "Allo Électricien",
  "url": "{{ .Site.BaseURL }}",
  "logo": "{{ .Site.BaseURL }}images/logo_1.svg",
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+33-1-44-90-11-31",
    "contactType": "emergency",
    "areaServed": "FR",
    "availableLanguage": "fr"
  },
  "sameAs": [
    "https://g.page/allo-electricien-paris"
  ]
}
</script>

<!-- Breadcrumb Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "ALLO Electricien",
      "item": "{{ .Site.BaseURL }}"
    }{{ if and .Params.department (ne .Params.department "null") }},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ .Params.department }}",
      "item": "{{ .Site.BaseURL }}electricien/{{ .Params.department }}"
    }{{ end }},
    {
      "@type": "ListItem",
      "position": {{ if and .Params.department (ne .Params.department "null") }}3{{ else }}2{{ end }},
      "name": "{{ .Params.city }}",
      "item": "{{ .Permalink }}"
    }
  ]
}
</script>

<!-- VideoObject Schema (if video exists for this city) -->
{{ if and .Params.slug .Site.Data.commune_videos }}
{{ $videoData := index .Site.Data.commune_videos .Params.slug }}
{{ if $videoData }}
{{ $cityName := .Params.city | default .Title }}
{{ $videoTitle := printf "Électricien d'urgence à %s" $cityName }}
{{/* Load electrician data for this city */}}
{{ $profilesData := .Site.Data.electricien_profiles }}
{{ $citySlug := .Params.slug }}
{{ $cityProfiles := slice }}
{{ if isset $profilesData.by_city $citySlug }}
  {{ $cityProfiles = index $profilesData.by_city $citySlug }}
{{ end }}
{{/* Select primary electrician (first profile) */}}
{{ $primaryElectrician := dict }}
{{ if gt (len $cityProfiles) 0 }}
  {{ $primaryElectrician = index $cityProfiles 0 }}
{{ end }}
{{ $thumbnailPath := "" }}
{{ if $videoData.thumbnail_path }}
  {{ $thumbnailPath = printf "%s%s" .Site.BaseURL $videoData.thumbnail_path }}
{{ else if .Params.cdnImages.video.jpg }}
  {{ $thumbnailPath = .Params.cdnImages.video.jpg }}
{{ else if .Params.cdnImages.hero.jpg }}
  {{ $thumbnailPath = .Params.cdnImages.hero.jpg }}
{{ else if .Params.images.hero }}
  {{ $thumbnailPath = printf "%simages/hero/%s.jpg" .Site.BaseURL .Params.images.hero }}
{{ end }}
{{ $videoUrl := "" }}
{{ if $videoData.video_mp4_compressed }}
  {{ $videoUrl = printf "%s%s" .Site.BaseURL $videoData.video_mp4_compressed }}
{{ else if $videoData.video_mp4 }}
  {{ $videoUrl = printf "%s%s" .Site.BaseURL $videoData.video_mp4 }}
{{ end }}
{{ if $videoUrl }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoObject",
  "name": "{{ $videoTitle }}",
  "description": "{{ if $videoData.voiceover_script }}{{ $videoData.voiceover_script | plainify | truncate 200 }}{{ else }}Découvrez les services d'électricien à {{ $cityName }}. Intervention rapide 24/7 pour tous vos besoins électriques.{{ end }}",
  {{ if $thumbnailPath }}"thumbnailUrl": "{{ $thumbnailPath }}",{{ end }}
  "contentUrl": "{{ $videoUrl }}",
  "uploadDate": "{{ if $videoData.created_at }}{{ $videoData.created_at }}{{ else }}{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}{{ end }}",
  "duration": "{{ if $videoData.duration_iso }}{{ $videoData.duration_iso }}{{ else }}PT45S{{ end }}",
  "width": "1920",
  "height": "1080",
  "inLanguage": "fr-FR",
  "publisher": {
    "@type": "LocalBusiness",
    "@id": "{{ .Site.BaseURL }}#organization",
    "name": "{{ if $primaryElectrician.first_name }}{{ $primaryElectrician.first_name }} {{ $primaryElectrician.last_name }}{{ else }}ECLAT RAPIDE ELECTRICITE{{ end }}",
    "alternateName": "Allo Électricien",
    "url": "{{ .Site.BaseURL }}",
    "telephone": "{{ if $primaryElectrician.phone_href }}{{ $primaryElectrician.phone_href }}{{ else }}+33-1-44-90-11-31{{ end }}",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "55-69 Avenue de Fontainebleau",
      "addressLocality": "Le Kremlin-Bicêtre",
      "postalCode": "94270",
      "addressCountry": "FR"
    },
    "priceRange": "€€",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.BaseURL }}eleclogos/logo.png",
      "width": "250",
      "height": "60"
    },
    "sameAs": [
      "https://g.page/allo-electricien-paris"
    ]
  },
  "potentialAction": {
    "@type": "WatchAction",
    "target": "{{ .Permalink }}"
  }{{ if $videoData.voiceover_script }},
  "transcript": "{{ $videoData.voiceover_script | plainify }}"{{ end }}
}
</script>
{{ end }}
{{ end }}
{{ end }}
{{- end }}{{/* end if eq .Section "services" */}}
{{- end }}{{/* end if .IsHome */}}
