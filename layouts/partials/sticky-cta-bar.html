<!-- Sticky Thumb-Zone CTA Bar (Mobile-First 2025 UX) -->
<div id="stickyCtaBar" class="sticky-cta-bar" style="transform: translateY(100%);">
  <div class="sticky-cta-content">
    <!-- Urgence Badge (Pulsing Animation) -->
    <div class="urgence-badge">
      <span class="pulse-dot"></span>
      <span class="urgence-text">URGENCE 24/7</span>
    </div>

    <!-- Primary CTA Button -->
    <a href="tel:{{ .Site.Params.phone }}"
       class="sticky-cta-button"
       onclick="trackCtaClick('sticky-bar', 'phone')">
      <svg class="w-6 h-6 mr-2 phone-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
      </svg>
      <div class="button-content">
        <span class="button-label" id="ctaButtonLabel">Appeler Maintenant</span>
        <span class="button-phone">{{ .Site.Params.phone }}</span>
      </div>
      <div class="button-arrow">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </div>
    </a>

    <!-- Close Button (Dismiss for 5 min) -->
    <button class="close-cta-btn" onclick="dismissCtaBar()" aria-label="Fermer">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <!-- Availability Indicator (Time-Aware) -->
  <div class="availability-indicator" id="availabilityIndicator">
    <span class="status-dot"></span>
    <span class="status-text" id="availabilityText">Disponible maintenant</span>
  </div>
</div>

<style>
  /* Sticky CTA Bar - Thumb Zone Optimized */
  .sticky-cta-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.98) 20%, rgba(255,255,255,1) 100%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08), 0 -1px 4px rgba(0, 0, 0, 0.04);
    z-index: 999;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    border-top: 1px solid rgba(0, 102, 255, 0.1);
  }

  .sticky-cta-bar.visible {
    transform: translateY(0) !important;
  }

  .sticky-cta-bar.hidden {
    transform: translateY(100%) !important;
  }

  .sticky-cta-content {
    display: flex;
    align-items: center;
    gap: 12px;
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
  }

  /* Urgence Badge */
  .urgence-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #FF0000;
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.5px;
    white-space: nowrap;
    box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3);
  }

  .pulse-dot {
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.2);
    }
  }

  .urgence-text {
    display: none;
  }

  /* Primary CTA Button */
  .sticky-cta-button {
    flex: 1;
    display: flex;
    align-items: center;
    background: linear-gradient(135deg, #0066FF 0%, #0052CC 100%);
    color: white;
    padding: 14px 16px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    min-height: 56px; /* Touch-friendly */
  }

  .sticky-cta-button:hover,
  .sticky-cta-button:active {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 102, 255, 0.4);
  }

  .sticky-cta-button:active {
    transform: translateY(0);
  }

  .phone-icon {
    animation: ring 2s ease-in-out infinite;
    flex-shrink: 0;
  }

  @keyframes ring {
    0%, 100% { transform: rotate(0deg); }
    10%, 30% { transform: rotate(-15deg); }
    20% { transform: rotate(15deg); }
  }

  .button-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 2px;
  }

  .button-label {
    font-size: 14px;
    font-weight: 700;
    line-height: 1.2;
  }

  .button-phone {
    font-size: 16px;
    font-weight: 800;
    letter-spacing: 0.5px;
  }

  .button-arrow {
    flex-shrink: 0;
    opacity: 0.8;
  }

  /* Close Button */
  .close-cta-btn {
    position: absolute;
    top: -36px;
    right: 8px;
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .close-cta-btn:hover {
    background: #f5f5f5;
    color: #333;
  }

  /* Availability Indicator */
  .availability-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: #666;
    margin-top: 6px;
    padding-left: 4px;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    background: #10B981; /* Green */
    border-radius: 50%;
    animation: blink 2s infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .status-text {
    font-weight: 500;
  }

  /* Desktop Adaptations */
  @media (min-width: 768px) {
    .sticky-cta-bar {
      padding: 16px 24px;
    }

    .urgence-badge {
      padding: 10px 16px;
      font-size: 12px;
    }

    .urgence-text {
      display: inline;
    }

    .sticky-cta-button {
      max-width: 500px;
      padding: 16px 24px;
    }

    .button-label {
      font-size: 15px;
    }

    .button-phone {
      font-size: 18px;
    }

    .close-cta-btn {
      position: relative;
      top: auto;
      right: auto;
    }
  }

  /* Hide on Footer Visibility */
  .sticky-cta-bar.near-footer {
    opacity: 0;
    pointer-events: none;
  }
</style>

<script>
  // Sticky CTA Bar Behavior
  (function() {
    const ctaBar = document.getElementById('stickyCtaBar');
    const availabilityText = document.getElementById('availabilityText');
    const ctaButtonLabel = document.getElementById('ctaButtonLabel');
    let lastScrollY = window.scrollY;
    let ticking = false;

    // Check if dismissed
    const dismissedUntil = localStorage.getItem('ctaBarDismissed');
    if (dismissedUntil && Date.now() < parseInt(dismissedUntil)) {
      return; // Don't show if dismissed
    }

    // Show bar after scroll or 3 seconds
    setTimeout(() => {
      if (ctaBar) ctaBar.classList.add('visible');
    }, 3000);

    // Update availability based on time
    function updateAvailability() {
      const hour = new Date().getHours();
      const statusDot = document.querySelector('.status-dot');

      if (hour >= 22 || hour < 6) {
        // Night hours
        if (availabilityText) availabilityText.textContent = 'Service nuit disponible';
        if (ctaButtonLabel) ctaButtonLabel.textContent = 'Urgence Nuit';
        if (statusDot) statusDot.style.background = '#FFD700'; // Gold
      } else if (hour >= 6 && hour < 9) {
        if (availabilityText) availabilityText.textContent = 'Ouvert dÃ¨s 6h';
      } else if (hour >= 18 && hour < 22) {
        if (availabilityText) availabilityText.textContent = 'Intervention ce soir';
      } else {
        if (availabilityText) availabilityText.textContent = 'Disponible maintenant';
      }
    }

    updateAvailability();
    setInterval(updateAvailability, 60000); // Update every minute

    // Hide when near footer
    function checkFooterVisibility() {
      const footer = document.querySelector('footer');
      if (!footer || !ctaBar) return;

      const footerRect = footer.getBoundingClientRect();
      const windowHeight = window.innerHeight;

      if (footerRect.top < windowHeight) {
        ctaBar.classList.add('near-footer');
      } else {
        ctaBar.classList.remove('near-footer');
      }
    }

    // Scroll handler
    function handleScroll() {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          checkFooterVisibility();

          // Show/hide based on scroll direction
          const currentScrollY = window.scrollY;
          if (currentScrollY > 300) {
            if (currentScrollY < lastScrollY) {
              // Scrolling up
              if (ctaBar) ctaBar.classList.add('visible');
            }
          }
          lastScrollY = currentScrollY;
          ticking = false;
        });
        ticking = true;
      }
    }

    window.addEventListener('scroll', handleScroll, { passive: true });

    // Track CTA clicks
    window.trackCtaClick = function(source, type) {
      console.log('CTA Click:', source, type);
      // Add your analytics tracking here
    };

    // Dismiss function
    window.dismissCtaBar = function() {
      if (ctaBar) {
        ctaBar.classList.remove('visible');
        ctaBar.classList.add('hidden');
        // Dismiss for 5 minutes
        localStorage.setItem('ctaBarDismissed', Date.now() + (5 * 60 * 1000));
      }
    };
  })();
</script>
