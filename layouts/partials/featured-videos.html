{{/* Featured Videos Section for Homepage */}}

{{ $videosData := .Site.Data.commune_videos }}
{{ if $videosData }}

<section id="videos" class="py-16 bg-gradient-to-br from-gray-50 to-blue-50">
  <div class="container mx-auto px-4">

    <!-- Section Header -->
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
        Découvrez Nos Services en Vidéo
      </h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        {{ len $videosData }} vidéos disponibles pour vous présenter nos électriciens dans toute l'Île-de-France
      </p>
    </div>

    <!-- Featured Videos Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 max-w-7xl mx-auto">

      {{ $counter := 0 }}
      {{ range $slug, $video := $videosData }}
        {{ if lt $counter 8 }}
        {{ $citySlug := $video.city_slug }}
        {{ $cityName := $video.city_name }}
        {{ $department := $video.department }}

        {{/* Build page URL */}}
        {{ $pageUrl := printf "/%s/" $citySlug }}

        {{/* Thumbnail path - CDN-first fallback chain */}}
        {{ $thumbnailPath := "" }}
        {{ if $video.thumbnail_path }}
          {{ $thumbnailPath = $video.thumbnail_path }}
        {{ else }}
          {{/* Look up the city page to get CDN images - use where for reliable lookup in loop context */}}
          {{ $cityPage := "" }}
          {{ range where $.Site.RegularPages "Params.slug" $citySlug }}
            {{ $cityPage = . }}
          {{ end }}
          {{ if $cityPage }}
            {{/* Try CDN video thumbnail first */}}
            {{ with $cityPage.Params.cdnImages.video.jpg }}
              {{ $thumbnailPath = . }}
            {{ else }}
              {{/* Fallback to CDN hero image */}}
              {{ with $cityPage.Params.cdnImages.hero.jpg }}
                {{ $thumbnailPath = . }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}

        <a href="{{ $pageUrl }}" class="group block bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">

          {{/* Video Thumbnail */}}
          <div class="relative aspect-video bg-gray-900">
            {{ if $thumbnailPath }}
              <img
                src="{{ $thumbnailPath }}"
                alt="Vidéo électricien {{ $cityName }}"
                class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"
                loading="lazy">
            {{ else }}
              <div class="w-full h-full bg-gradient-to-br from-primary to-blue-700 flex items-center justify-center">
                <span class="text-white text-2xl font-bold">{{ $cityName }}</span>
              </div>
            {{ end }}

            {{/* Play Button Overlay */}}
            <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 group-hover:bg-opacity-50 transition-all">
              <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-xl transform group-hover:scale-110 transition-transform">
                <svg class="w-8 h-8 text-primary ml-1" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                </svg>
              </div>
            </div>

            {{/* Duration Badge (if available) */}}
            {{ if $video.duration_seconds }}
            <div class="absolute bottom-2 right-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-xs font-semibold">
              {{ if lt $video.duration_seconds 60 }}
                {{ printf "%.0f" $video.duration_seconds }}s
              {{ else }}
                {{ printf "%.0f:%.0f" (div $video.duration_seconds 60) (mod $video.duration_seconds 60) }}
              {{ end }}
            </div>
            {{ end }}
          </div>

          {{/* Video Info */}}
          <div class="p-4">
            <h3 class="font-bold text-lg text-gray-900 mb-1 group-hover:text-primary transition-colors">
              Électricien {{ $cityName }}
            </h3>
            <p class="text-sm text-gray-600 mb-2">
              Département {{ $department }}
            </p>

            {{/* Certifications */}}
            {{ if $video.certifications }}
            <div class="flex flex-wrap gap-1 mt-2">
              {{ $certCount := 0 }}
              {{ range $video.certifications }}
                {{ if lt $certCount 3 }}
                  <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                    {{ . }}
                  </span>
                  {{ $certCount = add $certCount 1 }}
                {{ end }}
              {{ end }}
            </div>
            {{ end }}
          </div>
        </a>
        {{ $counter = add $counter 1 }}
        {{ end }}
      {{ end }}

    </div>

    {{/* View All Videos Button */}}
    <div class="text-center mt-12">
      <a href="/#directory"
         class="inline-flex items-center gap-2 bg-primary hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg transform transition-all duration-300 hover:scale-105">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        Voir toutes les vidéos
      </a>
    </div>

  </div>
</section>

{{ end }}
