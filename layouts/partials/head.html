<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Search Console Verification -->
<meta name="google-site-verification" content="YOUR_GOOGLE_VERIFICATION_CODE">

<!-- DNS Prefetch & Preconnect for External Resources -->
<link rel="dns-prefetch" href="https://unpkg.com">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

{{- if .IsHome }}
<title>{{ .Site.Title }}</title>
<meta name="description" content="{{ .Site.Params.description }}">
<meta name="keywords" content="{{ .Site.Params.keywords }}">
{{- else }}
<title>{{ .Params.title | default .Title }} | {{ .Site.Title }}</title>
<meta name="description" content="{{ .Params.description | default .Summary }}">
<meta name="keywords" content="{{ .Params.keyword }}, électricien {{ .Params.city }}, dépannage électrique {{ .Params.city }}">
{{- end }}

<!-- Open Graph / Social Media -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Params.title | default .Title }}{{ end }}">
<meta property="og:description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{ else }}{{ .Params.description | default .Summary }}{{ end }}">
{{- $ogImage := "" -}}
{{- if .Params.cdnImages.og.jpg -}}
  {{- $ogImage = .Params.cdnImages.og.jpg -}}
{{- else if .Params.images.og -}}
  {{- $ogImage = printf "%simages/og/%s.jpg" .Site.BaseURL .Params.images.og -}}
{{- end -}}
{{- if $ogImage }}
<meta property="og:image" content="{{ $ogImage }}">
<meta property="og:image:secure_url" content="{{ $ogImage }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="Service électricien professionnel {{ .Params.city | title }} {{ .Params.zipCode }}">
<meta property="og:image:type" content="image/jpeg">
{{- end }}

<!-- Video Open Graph Tags (if video exists for this page) -->
{{ if and .Params.slug .Site.Data.commune_videos }}
{{ $videoData := index .Site.Data.commune_videos .Params.slug }}
{{ if $videoData }}
{{ $videoUrl := "" }}
{{ if $videoData.video_mp4_compressed }}
  {{ $videoUrl = printf "%s%s" .Site.BaseURL $videoData.video_mp4_compressed }}
{{ else if $videoData.video_mp4 }}
  {{ $videoUrl = printf "%s%s" .Site.BaseURL $videoData.video_mp4 }}
{{ end }}
{{ if $videoUrl }}
<meta property="og:video" content="{{ $videoUrl }}">
<meta property="og:video:secure_url" content="{{ $videoUrl }}">
<meta property="og:video:type" content="video/mp4">
<meta property="og:video:width" content="1920">
<meta property="og:video:height" content="1080">
{{ end }}
{{ end }}
{{ end }}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Params.title | default .Title }}{{ end }}">
<meta name="twitter:description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{ else }}{{ .Params.description | default .Summary }}{{ end }}">
{{- if $ogImage }}
<meta name="twitter:image" content="{{ $ogImage }}">
<meta name="twitter:image:alt" content="{{ .Params.title | default .Title }}">
{{- end }}

<!-- Canonical URL -->
<link rel="canonical" href="{{ .Permalink }}">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/images/logo_1.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- Preload Critical Images for LCP Optimization (City pages only) -->
{{- if not .IsHome }}
  {{/* Preload video poster if video exists (takes priority over hero) */}}
  {{- if and .Params.slug .Site.Data.commune_videos -}}
    {{- $videoData := index .Site.Data.commune_videos .Params.slug -}}
    {{- if $videoData -}}
      {{- $videoPoster := "" -}}
      {{- if $videoData.thumbnail_path -}}
        {{- $videoPoster = $videoData.thumbnail_path -}}
      {{- else if .Params.cdnImages.video.jpg -}}
        {{- $videoPoster = .Params.cdnImages.video.jpg -}}
      {{- else if .Params.cdnImages.hero.jpg -}}
        {{- $videoPoster = .Params.cdnImages.hero.jpg -}}
      {{- end -}}
      {{- if $videoPoster }}
<link rel="preload" as="image" href="{{ $videoPoster }}" fetchpriority="high">
      {{- end -}}
    {{- else -}}
      {{/* No video: preload hero image instead */}}
      {{- $heroAvif := "" -}}
      {{- if .Params.cdnImages.hero.avif -}}
        {{- $heroAvif = .Params.cdnImages.hero.avif -}}
      {{- else if .Params.images.hero -}}
        {{- $heroAvif = printf "%simages/hero/%s.avif" .Site.BaseURL .Params.images.hero -}}
      {{- end -}}
      {{- if $heroAvif }}
<link rel="preload" as="image" href="{{ $heroAvif }}" type="image/avif" fetchpriority="high">
      {{- end -}}
    {{- end -}}
  {{- else -}}
    {{/* No video data: preload hero image */}}
    {{- $heroAvif := "" -}}
    {{- if .Params.cdnImages.hero.avif -}}
      {{- $heroAvif = .Params.cdnImages.hero.avif -}}
    {{- else if .Params.images.hero -}}
      {{- $heroAvif = printf "%simages/hero/%s.avif" .Site.BaseURL .Params.images.hero -}}
    {{- end -}}
    {{- if $heroAvif }}
<link rel="preload" as="image" href="{{ $heroAvif }}" type="image/avif" fetchpriority="high">
    {{- end -}}
  {{- end -}}
{{- end }}

<!-- Google Fonts (Optimized with font-display) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Critical CSS (Inline for immediate render) -->
<style>
  /* Critical CSS for above-the-fold content */
  *{box-sizing:border-box;margin:0;padding:0}
  html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:Inter,sans-serif}
  body{min-height:100vh;display:flex;flex-direction:column}
  .container{width:100%;margin:0 auto;padding:0 1rem}
  @media(min-width:640px){.container{max-width:640px}}
  @media(min-width:768px){.container{max-width:768px}}
  @media(min-width:1024px){.container{max-width:1024px}}
  @media(min-width:1280px){.container{max-width:1280px}}
  .hidden{display:none}
  .flex{display:flex}
  .bg-white{background-color:#fff}
  .text-gray-900{color:#111827}
  .font-bold{font-weight:700}
  .text-xl{font-size:1.25rem;line-height:1.75rem}
  .text-2xl{font-size:1.5rem;line-height:2rem}
  .text-3xl{font-size:1.875rem;line-height:2.25rem}
  .text-4xl{font-size:2.25rem;line-height:2.5rem}
  .mb-4{margin-bottom:1rem}
  .py-4{padding-top:1rem;padding-bottom:1rem}
  .px-4{padding-left:1rem;padding-right:1rem}
</style>

<!-- Tailwind CSS - DISABLED: Using local build instead -->
<!-- TO ENABLE LOCAL BUILD:
     1. Run: npm install -D tailwindcss
     2. Configure tailwind.config.js with proper purging
     3. Build: npx tailwindcss -o static/css/tailwind.min.css --minify
     4. Replace with: <link rel="stylesheet" href="/css/tailwind.min.css">
-->
<!--
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: '#0066FF',
          accent: '#FFD700',
          emergency: '#FF0000',
        },
        fontFamily: {
          sans: ['Inter', 'sans-serif'],
        },
        height: {
          '20': '3.2rem',
        },
      }
    }
  }
</script>
-->
<style>
  .from-primary {
    --tw-gradient-from: rgb(55 65 81) var(--tw-gradient-from-position) !important;
    --tw-gradient-to: rgb(55 65 81 / 0) var(--tw-gradient-to-position) !important;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to) !important;
  }
  .to-blue-700 {
    --tw-gradient-to: rgb(17 24 39) var(--tw-gradient-to-position) !important;
  }
  .from-primary\/85 {
    --tw-gradient-from: rgb(55 65 81 / 50%) var(--tw-gradient-from-position) !important;
    --tw-gradient-to: rgb(55 65 81 / 0) var(--tw-gradient-to-position) !important;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to) !important;
  }
  .to-blue-700\/85 {
    --tw-gradient-to: rgb(17 24 39 / 50%) var(--tw-gradient-to-position) !important;
  }
  .from-red-500 {
    --tw-gradient-from: #0052cc var(--tw-gradient-from-position) !important;
    --tw-gradient-to: rgb(239 68 68 / 0) var(--tw-gradient-to-position) !important;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to) !important;
  }
  .to-red-600 {
    --tw-gradient-to: #0066ff var(--tw-gradient-to-position) !important;
  }
</style>

{{- if .IsHome }}
<!-- Leaflet.js for Maps (Deferred & Async CSS) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" media="print" onload="this.media='all'">
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Leaflet MarkerCluster (Deferred) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" media="print" onload="this.media='all'">
<script defer src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<!-- Swiper.js for Carousel (Deferred) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" media="print" onload="this.media='all'">
<script defer src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
{{- else }}
<!-- Leaflet.js for individual page map (Deferred) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" media="print" onload="this.media='all'">
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
{{- end }}

<!-- Lottie Web Player for Animations (Deferred) -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" integrity="sha512-jEnuDt6jfecCjthQAJ+ed0MTVA++5ZKmlUcmDGBv2vUI/REn6FuIdixLNnQT+vKusE2hhTk2is3cFvv5wA+Sgg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- Alpine.js for Interactive Components (Accordions, Dropdowns) -->
<!-- Load Collapse plugin first, then Alpine.js core -->
<script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.13.3/dist/cdn.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

<!-- Custom CSS -->
<link rel="stylesheet" href="/css/custom.css">

<!-- Lazy Loading Script (Critical for performance) -->
<script defer src="/js/lazy-load.js"></script>

<!-- Schema.org Structured Data -->
{{ partial "schema.html" . }}
